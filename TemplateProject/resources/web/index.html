<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>TemplateProject WAM</title>
    <link href="styles/style.css" rel="stylesheet" type="text/css"/>
    <script src="scripts/audioworklet.js"></script>
    <!--<script src="scripts/websocket.js"></script>-->
    <script async src="fonts.js"></script>
    <!--<script async src="svgs.js"></script>-->
    <!--<script async src="imgs.js"></script>-->
    <!--<script async src="imgs@2x.js"></script>-->
    <!-- WebView-to-WAM Adapter - MUST be loaded before controller scripts -->
    <script src="scripts/webview-wam-adapter.js"></script>
    <!-- Compiled TypeScript entry point (bundled) -->
    <script src="scripts/index.bundle.js"></script>
  </head>
  <body>
    <div id="main"></div>
    <!-- WAM-specific UI elements (hidden in WebView mode) -->
    <div id="buttons" class="wam-only">
      <button type="button" id="startWebAudioButton" onclick="startWebAudio()">Start web audio!</button>
      <select id="midiInSelect" disabled="true"><option value="default">Midi input</option></select>
      <select id="midiOutSelect" disabled="true"><option value="default">Midi output</option></select>
      <progress value="0" max="100" id="progress"></progress>
    </div>
    <div id="greyout" class="wam-only">
      <div id="status">Ready - Click 'Start web audio!' to begin</div>
    </div>
    <div id="wam">
      <!-- TemplateProject UI - Universal UI for WebView (AU/VST3) and WAM (Web) -->
      <div id="pluginUI" style="padding: 15px; max-width: 1400px; margin: 0 auto;">
        <h2 style="color: #ffffff; margin: 0 0 15px 0; text-align: center; font-size: 24px; font-weight: bold;">TEMPLATE SYNTH</h2>
        <p id="adapterStatus" class="wam-only" style="color: #ffff00; text-align: center; margin-bottom: 15px; font-size: 11px;">Waiting for AudioWorklet initialization... Click "Start web audio!" above to begin.</p>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px;">
          <!-- ADSR Section -->
          <div style="border: 2px solid #ffffff; padding: 15px; background: rgba(0,0,0,0.3);">
            <h3 style="color: #ffffff; margin: 0 0 15px 0; font-size: 24px; font-weight: bold;">ADSR</h3>
            <div style="display: flex; flex-direction: column; gap: 15px;">
              <div>
                <label style="color: #ffffff; font-size: 12px; display: block; margin-bottom: 5px;">A - Attack</label>
                <input type="range" id="paramAttack" min="0" max="1" step="0.001" value="0.01" style="width: 100%;" oninput="updateParam(2, this.value)">
                <div style="color: #cccccc; font-size: 10px; text-align: right;" id="paramAttackValue">10 ms</div>
              </div>
              <div>
                <label style="color: #ffffff; font-size: 12px; display: block; margin-bottom: 5px;">D - Decay</label>
                <input type="range" id="paramDecay" min="0" max="1" step="0.001" value="0.01" style="width: 100%;" oninput="updateParam(3, this.value)">
                <div style="color: #cccccc; font-size: 10px; text-align: right;" id="paramDecayValue">10 ms</div>
              </div>
              <div>
                <label style="color: #ffffff; font-size: 12px; display: block; margin-bottom: 5px;">S - Sustain</label>
                <input type="range" id="paramSustain" min="0" max="1" step="0.01" value="0.5" style="width: 100%;" oninput="updateParam(4, this.value)">
                <div style="color: #cccccc; font-size: 10px; text-align: right;" id="paramSustainValue">50 %</div>
              </div>
              <div>
                <label style="color: #ffffff; font-size: 12px; display: block; margin-bottom: 5px;">R - Release</label>
                <input type="range" id="paramRelease" min="0" max="1" step="0.001" value="0.01" style="width: 100%;" oninput="updateParam(5, this.value)">
                <div style="color: #cccccc; font-size: 10px; text-align: right;" id="paramReleaseValue">10 ms</div>
              </div>
            </div>
          </div>

          <!-- Main Controls Section -->
          <div style="border: 2px solid #ffffff; padding: 15px; background: rgba(0,0,0,0.3);">
            <h3 style="color: #ffffff; margin: 0 0 15px 0; font-size: 24px; font-weight: bold;">MAIN</h3>
            <div style="display: flex; flex-direction: column; gap: 20px;">
              <div>
                <label style="color: #ffffff; font-size: 12px; display: block; margin-bottom: 5px;">GAIN</label>
                <input type="range" id="paramGain" min="0" max="1" step="0.001" value="1.0" style="width: 100%;" oninput="updateParam(0, this.value)">
                <div style="color: #cccccc; font-size: 10px; text-align: right;" id="paramGainValue">100 %</div>
              </div>
              <div>
                <label style="color: #ffffff; font-size: 12px; display: block; margin-bottom: 5px;">GLIDE</label>
                <input type="range" id="paramGlide" min="0" max="1" step="0.001" value="0.0" style="width: 100%;" oninput="updateParam(1, this.value)">
                <div style="color: #cccccc; font-size: 10px; text-align: right;" id="paramGlideValue">0 ms</div>
              </div>
            </div>
          </div>

          <!-- LFO Section -->
          <div style="border: 2px solid #ffffff; padding: 15px; background: rgba(0,0,0,0.3);">
            <h3 style="color: #ffffff; margin: 0 0 15px 0; font-size: 24px; font-weight: bold;">LFO</h3>
            <div style="display: flex; flex-direction: column; gap: 15px;">
              <div>
                <label style="color: #ffffff; font-size: 12px; display: block; margin-bottom: 5px;">SHAPE</label>
                <select id="paramLFOShape" style="width: 100%; padding: 5px; background: #000000; color: #ffffff; border: 1px solid #ffffff;" onchange="updateParamEnum(6, this.selectedIndex)">
                  <option value="0">Triangle</option>
                  <option value="1">Square</option>
                  <option value="2">Ramp Up</option>
                  <option value="3">Ramp Down</option>
                  <option value="4">Sine</option>
                </select>
              </div>
              <div>
                <label style="color: #ffffff; font-size: 12px; display: block; margin-bottom: 5px;">
                  <input type="checkbox" id="paramLFOSync" checked style="margin-right: 5px;" onchange="toggleLFOSync()"> SYNC
                </label>
              </div>
              <div id="lfoRateHzContainer" style="display: none;">
                <label style="color: #ffffff; font-size: 12px; display: block; margin-bottom: 5px;">RATE HZ</label>
                <input type="range" id="paramLFORateHz" min="0" max="1" step="0.001" value="0.025" style="width: 100%;" oninput="updateParam(7, this.value)">
                <div style="color: #cccccc; font-size: 10px; text-align: right;" id="paramLFORateHzValue">1.0 Hz</div>
              </div>
              <div id="lfoRateTempoContainer">
                <label style="color: #ffffff; font-size: 12px; display: block; margin-bottom: 5px;">RATE</label>
                <select id="paramLFORateTempo" style="width: 100%; padding: 5px; background: #000000; color: #ffffff; border: 1px solid #ffffff;" onchange="updateParamEnum(8, this.selectedIndex)">
                  <option value="0">1/64</option>
                  <option value="1">1/32</option>
                  <option value="2">1/16T</option>
                  <option value="3">1/16</option>
                  <option value="4">1/16D</option>
                  <option value="5">1/8T</option>
                  <option value="6">1/8</option>
                  <option value="7">1/8D</option>
                  <option value="8">1/4</option>
                  <option value="9">1/4D</option>
                  <option value="10">1/2</option>
                  <option value="11" selected>1/1</option>
                  <option value="12">2/1</option>
                  <option value="13">4/1</option>
                  <option value="14">8/1</option>
                </select>
              </div>
              <div>
                <label style="color: #ffffff; font-size: 12px; display: block; margin-bottom: 5px;">DEPTH</label>
                <input type="range" id="paramLFODepth" min="0" max="1" step="0.001" value="0.0" style="width: 100%;" oninput="updateParam(10, this.value)">
                <div style="color: #cccccc; font-size: 10px; text-align: right;" id="paramLFODepthValue">0 %</div>
              </div>
              <!-- LFO Waveform Visualization -->
              <div style="margin-top: 15px;">
                <label style="color: #ffffff; font-size: 12px; display: block; margin-bottom: 5px;">LFO WAVEFORM</label>
                <canvas id="lfoWaveform" width="400" height="80" style="width: 100%; height: 80px; border: 2px solid #ffffff; background: #000000; display: block;"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Output Level Meter -->
        <div style="margin-top: 15px; border: 2px solid #ffffff; padding: 12px; background: rgba(0,0,0,0.3);">
          <h3 style="color: #ffffff; margin: 0 0 10px 0; font-size: 18px; font-weight: bold;">OUTPUT LEVEL</h3>
          <div style="display: flex; gap: 15px; align-items: center;">
            <div style="flex: 1;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span style="color: #ffffff; font-size: 11px;">L</span>
                <span style="color: #ffffff; font-size: 11px;">R</span>
              </div>
              <div style="display: flex; gap: 8px; height: 180px;">
                <!-- Left channel meter -->
                <div style="flex: 1; display: flex; flex-direction: column-reverse; gap: 2px; background: rgba(255,255,255,0.1); border: 2px solid #ffffff; position: relative;">
                  <div id="meterLeft" style="background: linear-gradient(to top, #ff0000 0%, #ffaa00 70%, #00ff00 100%); width: 100%; min-height: 0%; transition: height 0.05s linear;"></div>
                </div>
                <!-- Right channel meter -->
                <div style="flex: 1; display: flex; flex-direction: column-reverse; gap: 2px; background: rgba(255,255,255,0.1); border: 2px solid #ffffff; position: relative;">
                  <div id="meterRight" style="background: linear-gradient(to top, #ff0000 0%, #ffaa00 70%, #00ff00 100%); width: 100%; min-height: 0%; transition: height 0.05s linear;"></div>
                </div>
              </div>
              <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                <span style="color: #cccccc; font-size: 10px;">-60</span>
                <span style="color: #cccccc; font-size: 10px;">-40</span>
                <span style="color: #cccccc; font-size: 10px;">-20</span>
                <span style="color: #cccccc; font-size: 10px;">0</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Keyboard Section -->
        <div style="margin-top: 15px; border: 2px solid #ffffff; padding: 12px; background: rgba(0,0,0,0.3);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <h3 style="color: #ffffff; margin: 0; font-size: 18px; font-weight: bold;">KEYBOARD</h3>
            <div style="color: #ffffff; font-size: 12px;">
              Octave: <span id="octaveDisplay">C4</span> |
              Use QWERTY keys: A-W-S-E-D-F-T-G-Y-H-U-J-K-O-L (Z/X = octave)
            </div>
          </div>
          <div id="pianoKeyboard" style="display: flex; position: relative; height: 120px; margin: 0 auto; max-width: 1000px;">
            <!-- Piano keys will be generated here -->
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
